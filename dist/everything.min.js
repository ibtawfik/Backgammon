!function(){"use strict";angular.module("myApp",[]).factory("backGammonLogicService",function(){function a(){return[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]]}function b(b){if(void 0===b.stateBeforeMove.board)return!0;var d,e,f=b.stateBeforeMove.board,g=b.stateAfterMove.fromDelta.fromDelta,h=b.stateAfterMove.toDelta.toDelta,i=[b.stateBeforeMove.dice1,b.stateBeforeMove.dice2],j=b.turnIndexBeforeMove,r=k(i);if(i[0]!=i[1]&&(g.length>2||h.length>2)||g.length>4||h.length>4)return console.log(75),!1;if((null===f||void 0===f||""===f||f===[[]])&&(f=a()),0===j)d="W",e="B";else{if(1!==j)return console.log(91),!1;d="B",e="W"}for(var s=0;s<h.length;s++)if(1===h[s]||26===h[s])return console.log(97),!1;if(!m(g,h,r)){var t=r;if(t=[],angular.copy(r,t),t=n(g,h,t),p(f,t,d))return console.log(129),!1}for(var s=0;s<h.length;s++)if(c(d,f))for(var u=0;u<h.length;u++)if(""!==g[u]&&""!==h[u]&&Math.abs(g[u]-h[u])>0&&1!==g[u]&&26!==g[u])return console.log(145),!1;for(var s=0;s<h.length;s++){if("W"===d&&27===h[s]&&!q(f,d))return console.log(159),!1;if("B"===d&&0===h[s]&&!q(f,d))return console.log(166),!1}for(var s=0;s<h.length;s++)if(l(f,h[s])===e)return console.log(175),!1;for(var v=0,s=0;s<g.length;s++)""!==g[s]&&v++;if(2===r.length&&1===v){if("W"===d&&"B"===l(f,g[0]+r[0])&&"B"===l(f,g[0]+r[1]))return console.log(193),!1;if("B"===d&&"W"===l(f,g[0]-r[0])&&"W"===l(f,g[0]-r[1]))return console.log(201),!1}else if(4===r.length)for(var s=0;v>=s;s++)if("W"===d){for(var u=g[s];u<=h[s];u+=r[0])if("B"===l(f,u))return console.log(212),!1}else for(var u=g[s];u>=h[s];u-=r[0])if("W"===l(f,u))return console.log(219),!1;for(var t=r,s=0;s<g.length;s++)""!==g[s]&&0!==h[s]&&27!==h[s]&&(t=o(g[s],h[s],t));for(var s=0;s<g.length;s++)if(0===h[s]||27===h[s]){var w=Math.abs(g[s]-h[s]);t.sort(function(a,b){return b-a});for(var x=0,u=t.length;u>=0;u--)if(x+t[u]>=w){t.splice(u,t.length-(u+1)),x=0;break}}return!0}function c(a,b){var c;c="W"===a?1:26;for(var d=0;15>d;d++)if(b[c][d]===a)return!0;return!1}function d(b,c,d,g,h){var i=[];angular.copy(h,i),i=k(i);var j,o;if((null===c||void 0===c||""===c||c===[[]])&&(c=a()),0===b)j="W",o="B";else{if(1!==b)throw new Error(t.NO_PLAYER);j="B",o="W"}for(var r=0;r<g.length;r++)if(1===g[r]||26===g[r])throw new Error(t.ILLEGAL_DELTA);if(!m(d,g,i)){var s=i;s=[],angular.copy(i,s),s=n(d,g,s);var u=[[]];angular.copy(c,u);for(var r=0;r<d.length;r++)""!==d[r]&&(u=f(u,d[r],g[r],j));if(p(u,s,j))throw new Error(t.INCOMPLETE_MOVE)}var v=0,w=0;w="W"===j?1:26;for(var r=0;15>r;r++)c[w][r]===j&&v++;if(v>0){for(var x=0,y=0,r=0;r<d.length;r++)d[r]===w?x++:y++;if(v>x&&y>0)throw new Error(t.ILLEGAL_MOVE)}for(var r=0;r<g.length;r++){if("W"===j&&27===g[r]&&!q(c,j))throw new Error(t.ILLEGAL_MOVE);if("B"===j&&0===g[r]&&!q(c,j))throw new Error(t.ILLEGAL_MOVE)}for(var r=0;r<g.length;r++)if(l(c,g[r])===o)throw new Error(t.ILLEGAL_MOVE);for(var z=0,r=0;r<d.length;r++)""!==d[r]&&z++;if(2===i.length&&1===z){if("W"===j&&"B"===l(c,d[0]+i[0])&&"B"===l(c,d[0]+i[1]))throw new Error(t.ILLEGAL_DELTA);if("B"===j&&"W"===l(c,d[0]-i[0])&&"W"===l(c,d[0]-i[1]))throw new Error(t.ILLEGAL_DELTA)}else if(4===i.length)for(var r=0;z>=r;r++)if("W"===j){for(var A=d[r];A<=g[r];A+=i[0])if("B"===l(c,A))throw new Error(t.ILLEGAL_MOVE)}else for(var A=d[r];A>=g[r];A-=i[0])if("W"===l(c,A))throw new Error(t.ILLEGAL_MOVE);for(var s=i,r=0;r<d.length;r++)""!==d[r]&&0!==g[r]&&27!==g[r]&&(s=n(d[r],g[r],s));for(var r=0;r<d.length;r++)if(0===g[r]||27===g[r]){var B=Math.abs(d[r]-g[r]);if(0===s.length)throw new Error(t.ILLEGAL_DELTA);s.sort(function(a,b){return b-a});for(var C=0,A=s.length;A>=0;A--)if(C+s[A]>=B){s.splice(A,s.length-(A+1)),C=0;break}}for(var D=c,r=0;r<d.length;r++)""!==d[r]&&(D=f(D,d[r],g[r],j));var E;E=e(j,c)?{endMatch:{endMatchScores:"W"===j?[1,0]:"B"===j?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-b}};var F=[E,{set:{key:"board",value:D}},{set:{key:"fromDelta",value:{fromDelta:d}}},{set:{key:"toDelta",value:{toDelta:g}}},{setRandomInteger:{key:"dice1",from:1,to:7}},{setRandomInteger:{key:"dice2",from:1,to:7}}];return F}function e(a,b){for(var c=0,d=i(a),e=0;e<b[d].length;e++)b[d][e]===a&&c++;return 15===c}function f(a,b,c,d){for(var e=14;e>=0;e--)if(a[b][e]===d){a[b][e]="";break}if(a[c][0]===g(d)){a[c][0]=d;var f=h(g(d)),i=j(a,f);return a[f][i]=g(d),a}var i=j(a,c);return a[c][i]=d,a}function g(a){return"W"===a?"B":"W"}function h(a){return"W"===a?1:26}function i(a){return"W"===a?27:0}function j(a,b){for(var c=0;c<a[b].length;c++)if(""===a[b][c])return c}function k(a){return a[0]===a[1]?[a[0],a[0],a[0],a[0]]:a}function l(a,b){var c,d=0;if(b>25||2>b)return void 0;for(var e=0;15>e;e++)if(""!==a[b][e]&&(d++,c=a[b][e],d>=2))return c;return""}function m(a,b,c){for(var d=0,e=0;e<c.length;e++)""!==c[e]&&(d+=c[e]);for(var f=0,e=0;e<b.length;e++)""!==b[e]&&(f+=Math.abs(b-a));if(f>d)for(var e=0;b.length;e++)if(0===b[e]||27===b[e])return!0;return d===f}function n(a,b,c){for(var d=[],e=0;e<a.length;e++)""!==a[e]&&d.push(Math.abs(a[e]-b[e]));for(var f=!0,e=0;e<c.length-1;e++)if(c[e]!==c[e+1]){f=!1;break}if(f)for(var g=0,e=0;e<d.length;e++){g+=d[e];var h=c.length;if(h>0&&g%c[0]===0){var i=g/c[0];h>=i&&(console.log("number of elements to remove"),console.log(i),c.splice(0,i),g=0)}}else for(var j=0,e=0;e<d.length;e++)for(var k=c.length-1;k>=0;k--){j=0;for(var l=k;l>=0;l--)j+=c[l],j===d[e]&&c.splice(l,k+1)}return c}function o(a,b,c){var d;d=Math.abs(a-b);for(var e=0,f=c.length-1;f>=0;f--){e=0;for(var g=f;g>=0;g--)e+=c[g],e===d&&c.splice(g,f+1)}return c}function p(a,b,c){for(var d=!1,e=0;e<b.length;e++)if(void 0!==b[e]){d=!0;break}if(!d)return!1;if("W"===c&&"W"===a[1][0]){for(var e=0;e<b.length;e++)if("B"!==l(a,b[e]))return!0;return!1}if("B"===c&&"B"===a[26][0]){for(var e=0;e<b.length;e++)if("W"!==l(a,26-b[e]))return!0;return!1}if("W"===c&&q(a,c))for(var e=0;e<b.length;e++)for(var f=19;25>=f;f++)if("W"===a[f][0]&&f+b[e]>25)return!0;if("B"===c&&q(a,c))for(var e=0;e<b.length;e++)for(var f=2;7>=f;f++)if("B"===a[f][0]&&f-b[e]<2)return!0;if("W"===c)for(var e=1;25>=e;e++)for(var f=0;f<b.length;f++)if("W"===a[e][0]&&"B"!==l(a,e+b[f])&&void 0!==l(a,e+b[f]))return!0;if("B"===c)for(var e=25;e>=2;e--)for(var f=0;f<b.length;f++)if("B"===a[e][0]&&"W"!==l(a,e-b[f])&&void 0!==l(a,e-b[f]))return!0;return!1}function q(a,b){var c=0;if("W"===b)for(var d=1;26>d;d++)for(var e=0;15>=e;e++)if("W"===a[d][e]){if(20>d)return!1;c++}if("B"===b)for(var d=27;d>=2;d--)for(var e=0;15>e;e++)if("B"===a[d][e]){if(d>7)return!1;c++}return c>0?!0:void 0}function r(a,b,c){var d=[],e=[],g=[[]],h=[[]];if(angular.copy(a,g),angular.copy(b,d),0===b.length||!p(a,b,c))return!1;for(var i=[],j=0;j<d.length;j++)for(var k=d[j],l=1;26>=l;l++){var m=l,n=s(g,c,k,m),o={from:[m],to:[n]};if(2===o.from[0]);if(n!==!1){angular.copy(d,e),e.splice(j,1),angular.copy(g,h),h=f(h,m,n,c);var q=r(h,e,c);if(q!==!1&&void 0!==q)for(var t=0;t<q.length;t++){var u=[];angular.copy(o,u);for(var v=0;v<q[t].from.length;v++){var w=q[t].from[v],x=q[t].to[v];u.from.push(w),u.to.push(x),i.push(u)}}else i.push(o)}}return i}function s(a,b,c,d){var e=[c];if(!p(a,e,b))return!1;var f=1;f="W"===b?1:26;for(var h=0;15>h;h++)if(a[f][h]===b&&d!==f)return!1;for(var i=!1,h=0;15>h;h++)a[d][h]===b&&(i=!0);if(i===!1)return i;var j=!1;return"W"===b&&(l(a,c+d)!==g(b)&&25>=c+d?j=c+d:c+d>25&&q(a,b)&&(j=27)),"B"===b&&(l(a,d-c)!==g(b)&&d-c>=2?j=d-c:d-c>2&&q(a,b)&&(j=0)),j}var t,t={ILLEGAL_MOVE:"ILLEGAL_MOVE",ILLEGAL_DELTA:"ILLEGAL_DELTA",INCOMPLETE_MOVE:"INCOMPLETE_MOVE",NO_PLAYER:"NO_PLAYER"};return{isMoveOk:b,createMove:d,getInitialBoard:a,totalMoves:k,hasUsedFullRoll:m,getUnusedRolls:n,heldBy:l,getPossibleMoves:r,hasLegalMove:p,makeMove:f}})}(),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","backGammonLogicService","resizeGameAreaService",function(a,b,c,d,e,f,g){function h(b){var c=e.getMatchState();if(console.log(c),void 0===b.stateAfterMove.board){var d=[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]];a.board=d}else a.board=b.stateAfterMove.board;a.fromDelta=[],a.toDelta=[],a.dice=[b.stateAfterMove.dice1,b.stateAfterMove.dice2],a.dice1=b.stateAfterMove.dice1,a.dice2=b.stateAfterMove.dice2,a.turnIndex=b.turnIndexAfterMove;var g=[];angular.copy(a.dice,g),g=f.totalMoves(g),a.fullDiceArray=g;var h=[[]];if(angular.copy(a.board,h),a.originalBoard=h,"playAgainstTheComputer"===b.playMode)for(var i=f.getPossibleMoves(a.board,a.fullDiceArray,"B"),j=(Math.floor(Math.random()*i.length)+1,0);j<i.from.length;j++)a.clickPiece(i.from[j]),a.clickSpace(i.to[j])}function i(b){switch(b){case 1:return"d1.gif";case 2:return"d2.gif";case 3:return"d3.gif";case 4:return"d4.gif";case 5:return"d5.gif";case 6:return"d6.gif";default:return console.log("error dice out of range:"+a.dice1),""}}g.setWidthToHeight(1),window.e2e_test_stateService=e,a.clickPiece=function(c){return console.log("piece clicked"),0===a.turnIndex&&"W"!==a.board[c][0]?void b.info("White turn, clicked on black player"):1===a.turnIndex&&"B"!==a.board[c][0]?void b.info("Black turn, clicked on white player"):a.fromDelta.length===a.toDelta.length?void a.fromDelta.push(c):a.fromDelta.length!==a.toDelta.length?void(a.fromDelta[a.fromDelta.length-1]=c):void 0},a.clickSpace=function(c){console.log("SUCESS: "+c),a.toDelta.length===a.fromDelta.length&&console.log("Must select a piece to move first");var e,g;if(0===a.turnIndex?(e="W",g="B"):(e="B",g="W"),0===a.turnIndex&&"W"!==a.board[a.fromDelta[a.fromDelta.length-1]][0])b.info("Not white's turn");else if(1===a.turnIndex&&"B"!==a.board[a.fromDelta[a.fromDelta.length-1]][0])b.info("Not blacks turn");else{if(f.heldBy(a.board,c)===g)return void console.log("positoin held by opposing player");console.log("full dice array before:"),console.log(a.fullDiceArray);var h=f.getPossibleMoves(a.board,a.fullDiceArray,e);console.log("full dice array after:"),console.log(a.fullDiceArray);for(var i=!1,j=0;j<h.length;j++)h[j].from[0]===a.fromDelta[a.fromDelta.length-1]&&h[j].to[0]===c&&(i=!0);for(var j=0;j<h.length;j++)for(var k=a.fromDelta[a.fromDelta.length-1],l=c,m=Math.abs(k-l),n=0,o=0;o<h[j].from.length;o++)if(n+=Math.abs(h[j].from[o]-h[j].to[o]),n===m&&h[j].from[0]===k&&h[j].to[o]===l){i=!0;break}if(i){if(a.toDelta.push(c),f.makeMove(a.board,a.fromDelta[a.fromDelta.length-1],c,e),angular.copy(a.dice,a.fullDiceArray),a.fullDiceArray=f.totalMoves(a.fullDiceArray),f.getUnusedRolls(a.fromDelta,a.toDelta,a.fullDiceArray),!f.hasLegalMove(a.board,a.fullDiceArray,e))try{var p=f.createMove(a.turnIndex,a.originalBoard,a.fromDelta,a.toDelta,a.dice);console.log("move being made"),d.makeMove(p)}catch(q){b.info("Illegal Move"),console.log(q)}}else{if(h!==!1)return void console.log("Get possible move malfunction");if(!f.hasLegalMove(a.board,a.fullDiceArray,e))try{var p=f.createMove(a.turnIndex,a.originalBoard,a.fromDelta,a.toDelta,a.dice);console.log("move being made"),d.makeMove(p)}catch(q){b.info("Illegal Move"),console.log(q)}}}},a.completeMove=function(){try{var c=f.createMove(a.turnIndex,a.board,a.fromDelta,a.toDelta,a.dice);d.makeMove(c)}catch(e){b.info("Illegal move")}},a.rollDice=function(){a.dice1=Math.floor(6*Math.random())+1,a.dice2=Math.floor(6*Math.random())+1;var b=[a.dice1,a.dice2];return a.dice=b,b},a.getImageSource=function(b,c){var d=a.board[b][c];return"W"===d?"white_man.png":"B"===d?"black_man.png":""},a.getRowPosition=function(a){if(1===a||26===a)return"46%";if(a>=2&&7>=a){var b=9+6*(a-2);return b+"%"}if(a>=8&&13>=a){var b=18.5+6*(a-2);return b+"%"}if(a>=14&&19>=a){var b=85-6*(a-14);return b+"%"}if(a>=20&&25>=a){var b=39-6*(a-20);return b+"%"}return"0%"},a.getColumnPositon=function(a,b){if(a>=1&&13>=a){var c=6+4*b;return c+"%"}if(a>=14&&26>=a){var c=87-4*b;return c+"%"}return"0%"},a.getBoardPosition=function(a,b){var c=getColumnPositon(b),d=getRowPosition(a);return void 0===c||void 0===d?"":"{position:absolute; top:"+c+"%; right:"+d+"%; width:7%; height:7%}"},a.shouldShowImage=function(b,c){if(0===b||27===b)return!1;var d=a.board[b][c];return""!==d},a.getDice1=function(){return i(a.dice1)},a.getDice2=function(){return i(a.dice2)},a.pieceColor=function(b,c){return a.board[b][c]},d.setGame({gameDeveloperEmail:"ibtawfik@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:h}),d.makeMove([{set:{key:"board",value:[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","B","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["B","B","B","B","B","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["W","W","W","W","W","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["B","B","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]]}},{set:{key:"fromDelta",value:{fromDelta:[]}}},{set:{key:"toDelta",value:{toDelta:[]}}},{setTurn:{turnIndex:0}},{setRandomInteger:{key:"dice1",from:1,to:7}},{setRandomInteger:{key:"dice2",from:1,to:7}}])}]);
//# sourceMappingURL=everything.min.js.map